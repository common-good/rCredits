2014-01-09
. exchanges of r for usd are no longer in r_txs -- they are in r_usd only. All transactions between members are rCredits only. This made the "r" and usdXid fields in r_txs moot so they are gone.
. fixed bug that kept set-password from working for admin (patched)
. fixed bug in formGet (Bank tab) that got USD for the community instead of the member (made new test for it)

2014-01-08
. devices are now handled consistently and elegantly on Devices page
. firstUnusedId is used only for new users and works in all cases (r\acct::nextId() works fine)
. removed the "Create Agent Account" feature. 
. released held emails 
. invites are now allowed
. disabled Charge tab (until invoices are implemented properly)
. added serial id field to r_invites
. cleaned up r_boxes (added new int fields boxnum and channel before trying to reinstall)
. deleted all cashier accounts and fixed transactions that had those agents
. worked around Google Chrome bug that populates Company Phone field with user's phone, on signup
. invites now always come from agent
. multiple invite feature for admin only (uses William's info)
. fixed bug that showed negative returns on Summary page when average balance was negative (now shows infinite APR)
. admin and CGF company agents can see who is a member by clicking on a link on the Community page
. committed amount will never be displayed negative on Summary page
. temporarily disabled "charge" on SMS
. fixed bug in averageBalance function -- it was failing to include deposits/withdrawals (patched)

2013-12-31
. rPOS now handles default cashier (defaults to the company pro se)
. company permission to share rPOS with other companies is now implicit in CO_REQUIRE_CASHIER
. revamped gap finder as firstUnusedId function, but it has problems still (need tests)

2013-12-24
. new non-member cashiers got uid ZZZ.AAA etc (should be NEW.whatever). fixed.
. usd total is now cached for communities and regions (fixes a bug in pool in rcron)
. fixed two homogenize bugs (it was transferring USD to the least needy first, then continuing until exhausted and beyond)
. provided a link on relations page for member companies to print their own rPOS sign-in cards (no photo)
. fixed relations page formatting
. can now open another rCredits account before confirming bank deposits
. for admin, we no longer try to register an account with Dwolla when visiting the summary page (you must go to the status page instead)
. now we are notified by email whenever there are deposits or withdrawals
. new payment notices now show both physical and postalAddr and sometimes phone number, so member can ship or thank.
. administrator can now sign agreement for people and companies
. made averageBalance() more efficient and accurate by looping after a single query
. selecting "none of the above" on Open Another Account form now gives error message.
. fixed bug that kept setBank() from working
. fixed bug that allowed member "ready" status with no photo
. now accepts photos in several formats (PNG etc)
. verifyBy no longer defaults and is required
. fixed bug: PIN "0000" didn't work
. began changing rPOS interface to handle default cashiers

2013-12-05
. moved dwolla.php to rcredits folder
. changed how accounts form works so changing account and logging out always work right
. Membership tests now mostly work!
. fixed bug that kept dobs from getting recorded right
. change personal account opening process so last step is not required before person is a member
. began rsmart Exchange feature tests
. tweaked cron's homogenize1() so it trades USD for r only when inappropriate
. changed card code len to 14 (to avoid occasional complex QRs)
. fixed bug whereby Community page mistakenly showed rCredits as issued, that the community exchanged for USD
. non-code changes:
	- fixed dobs if not numeric (run eachAcct)
	- fixed data[verifyBy] to be if ('') SMS or (if 1 or not set) Voice (run eachAcct)
	- changed all @rcredits-org.com email addresses to @rc4.me (see util in admin.inc)
	- changed William's cardCode2 and printed him a new Company Agent card

2013-11-25
. restored addPhone(), accidentally deleted during separation of rweb-subs.inc from rweb.inc
. moved several functions back to rweb.inc from rweb-subs.inc that are called directly from URL
. implemented businessStructure parameter in Dwolla registration of companies
. eliminated "personal & commercial" account type (initial account is always personal)
. reworked homogenizing and pooling

2013-11-22
. all relevant tests pass
. added a notice that reward-sharing has been initiated (to precede the notice about it going through)
. got cron tests to pass again (given that nearly all transactions are in rCredits
. simplified formI and ScanCard tests to just go to rcredits.org or member page (for company cards)
. made the company cards say "Company Agent"
. non-code changes:
  - rename structure field "coFlags" in r_companies
  - create table r_boxes like r_boxnames; insert r_boxes select * from r_boxnames;
  - (no need to change fieldnames)
  - reinstall
  - delete r_smarts, r_boxnames after reinstall
  - add r_sms records to r_boxes (query?)
  - change all rebate pcts to 10
  - update dwolla.php

2013-11-19
. added Spendable: to the customer balance for rSmart
. expanded selling field to multiple lines
. expanded structure field to include miscellaneous company flags (renamed it coFlags)
. wrote all automated tests for rSmart (for the new rPOS) and they all pass!
. rWeb and rCron tests probably no longer work (address that next)

2013-10-28
. updated rsmart module to feed new POS app
. miscellaneous refactoring

2013-10-11
. created an admin tool and retrofited old accounts on prod server, recording dwollapin, dwollaphone, etc.
. changed r\quid to accept negative uids (quid is a single call to u\n2a() -- no dot)
. doubleclick (instead of single) on messages to make them vanish
. removed amount field from relations page
. admin can remove last manager from a company account or add one to a company with none
. clicking on photo no longer signs you out (patched on prod server)
. catch "you changed your password" and "you changed your email" emails from Dwolla (and disable the rC account with a misbehavior note in the data field)
. do transactions entirely in rCredits (even if the r balance goes negative). Distribute the USD evenly throughout the system (but with half in ctty account), for multiple cash-outs in one day.
. separated database function into rcredits-db.inc, namespace rCredits\DB (db)
. separated web subs into rweb-subs.inc
. added personal statistics to Summary page
. disabled soldOut function in cron (patched on production server)

2013-10-01
. don't list self as possible proxy
. tests expect tx rewards on entire amount, not just on the rCredits amount (r)
. no r% column
. no r/USD columns in download
. hover help on statistics page
. changed Bank setting to Bank Info
. added "skip" and "resume" to Gherkin
. added accountInfo step to dwolla and usd classes
. badDate function
. homogenize and pool functions in cron
. amount to withdraw in one day is limited to $10 from each other member
. gave bank transactions a tid (b#)
. transactions are now sorted (descending) by date, by tid before displaying

2013-09-22
. initialized stats on server: for ($dt = strtotime('5/23/2013'); $dt < time(); $dt += DAY_SECS) rCredits\getStats(-8915, $dt);
. made tests check for presence of labels on weShow, with, and without.
. allowed vertical arrays in tests
. disabled payment exchanges (virtual payments) in cron
. hid r% column and option to show/hide exchanges on Transactions page
. changed usd::source() to handle Dwolla's new practice of returning Dwolla balance as a source

2013-09-05
. changed physical field to postalAddr (and fixed data on production server)
. completed automation of dwolla account setup for companies
. fixed problems with show/hide javascripts
. created an "Agent Account" form
. fixed problems with Open Another Account
. PIN field now appears on Contact form ONLY if email changes
. on mobile, made messages absolute position. Any platform, click the message to dismiss it
. tell members they missed out on keeping their r (weekly) and give a clickable link to change their minimum to the suggested amount, without requiring signin
. fixed bug which made SCAN-only cashiers unable to sell (patched on production server)
. added an Undo tab (hidden except for mobile)
. settings gear omitted if no permission to manage account
. improved reports page drastically and renamed it "Statistics"
. started a separate rCredits-theme project (see) to accommodate Undo menu item on mobile interface

2013-09-02
. simplification of options when scanning a card; for example, never any "change acct" button on formI
. created form account/ssn
. created form account/kba
. "Not yet a member? <a>Check it out</a>!" on login
. members can scan their own card to sign in (just add pword)
. revised tests and usd class to use Dwolla sandbox effectively for testing
. added verification of AuthorizedRepresentative (for that Dwolla registration step of that name)
. passes all tests except Membership (tests need revision)

2013-08-30
. moved email (and email change) to contact form
. require pin instead of password, to change email
. moved password, pin, and photo change to their own pages, with links from security page
. fixed bug in misc.js that undid all check box clicks (patched on production server)
. added signout to account dropdown
. re-ordered settings categories
. changed r\go() to accept ordinary messages, not just errors
. renamed "Get r/USD" to "Bank"
. implemented bank addition and verification form
. bank form shows only last four digits of bank account number
. added committed amount to summary (on rewards line) "reserved for contributions to CGF"
. fixed bug that hid charge tab for almost everyone
. implemented automatic phone, address, and ssn verification (for Dwolla account)
. fixed hiding of stuff on reg page as appropriate
. changed QR code format to allow longer cardcodes (expanded feature tests accordingly, to make sure old cards continue working)
- in formAccount did away with Drupal basis
- moved variable stuff from settings.php to boot.php
- improved forward.php to parse drupal messages and send html-formatted emails

2013-08-25
. fixed creditInfo() so it handles fee amounts properly (and displays right on Transactions page)
. fixed coverFee() so it creates a record in r_usd (and added missing reimbursements to production site)
. assured that summary page, transactions page, and downloads all show the same amounts
. fixed nextRBuyer bug (another bug) which mistakenly considered minimum balance (patched on production server)
. added an admin feature to cobble up a new account while waiting for the new dwolla reg api to be done
. system errors now email staff
. now gives error message if repeating the amount and other person as the previous transaction from same machine.
. fixed registration form javascript to show/hide fields depending on account type
. fixed coverFee bug (if Dwolla was unavailable, it queued the wrong function name) (patched on production server)
. fixed edit transaction purpose crash bug (patched on production server)
. adjusted settings.php, dwolla.php, and usd class to handle Dwolla sandbox self-signing certificate
. fixed tiny profile picture bug so user's photo now shows (patched on production server)
. eliminated tabs on login screen / separated registration and password change from dwolla builtin functions
. created new signup procedure, using Dwolla's new registration API (just the first step so far)
. changed calculator buttons to <button> and adjusted format to work on iPhones

2013-08-11
. fixed nextRBuyer bug, which chose the same member every time (patched on production server)
. fixed bankFollowup bug, which failed to mark transfers FROM bank completed (patched on production server and ran for each user, to fix data)
. shortened numeric keypad so it fits better on mobile screen (patched on production server)
. fixed bug that ran daily cron twice a day (patched on production server)
. fixed download bug (kept downloads from working at all)
. eliminated usdTid column in downloads
. everything uploaded to production server

2013-08-06
. changed "virtual payments" to "payment exchanges”
. Changed maximum bank delay to 10 days.  Patched on production server. Fixes double bank withdrawal bug. 
. City and state zip code without using USPS API 
. Icons on settings page 

2013-07-29
- Option to use internal Dwolla sandbox (including changes to settings.php and dwolla.php)
- calculator for mobile amount entry
- simplified mobile header, menus, global links, and help
- fixed mobile formatting on Preferences page
- added addBank() and verifyBank() to usd class

2013-07-11
- scan permission
- popup help throughout Transaction History page
- handle lost USD deposits/withdrawals/fees
- monthly inflation adjustment (and tests)
- sharing rewards with CGF (and tests)

2013-07-05
- added optional box column to Transaction History
- changed companies field "id" to "uid" (for consistency)
- new password not required after "Request New Password" if user logs in with valid old

2013-07-04
- changed values of tx types (needs to be updated in production database)
- added "From Bank" and "Fees" to Transaction History
- all Dwolla fees will now be reimbursed by the community (unless reimbursed by Dwolla). This also fixes problems with accurate USD balance caching
- fixed bug in r\nextRBuyer() that prevented members from buying rCredits if they had transactions but had never traded USD for rCredits (patched on production server)